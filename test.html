<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes bulletins de paie</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .payslip-container {
            display: flex;
            min-height: 100vh;
            background-color: #fff;
        }

        /* Header */
        .headerxx {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #fff;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 300px;
            padding: 8px 12px 8px 40px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background-color: #f8f9fa;
        }

        .search-input:focus {
            outline: none;
            border-color: #007bff;
            background-color: #fff;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
            font-size: 14px;
        }

        .header-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .download-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .download-button:hover {
            background-color: #0056b3;
        }

        .download-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* Sidebar */
        .sidebarxx {
            width: 280px;
            background-color: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding-top: 80px;
            overflow-y: auto;
        }

        .sidebarxx-section {
            padding: 20px;
        }

        .year-section {
            margin-bottom: 30px;
        }

        .year-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background-color: #fff;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .year-header:hover {
            background-color: #f1f3f5;
        }

        .year-title {
            font-weight: 600;
            font-size: 14px;
            color: #495057;
        }

        .year-count {
            background-color: #6c757d;
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            min-width: 20px;
            text-align: center;
        }

        .chevron {
            color: #6c757d;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .year-section.expanded .chevron {
            transform: rotate(90deg);
        }

        .months-list {
            display: none;
            padding-left: 16px;
        }

        .year-section.expanded .months-list {
            display: block;
        }

        .month-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            margin-bottom: 4px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            color: #6c757d;
        }

        .month-item:hover {
            background-color: #e9ecef;
            color: #495057;
        }

        .month-item.active {
            background-color: #007bff;
            color: white;
        }

        .month-icon {
            font-size: 14px;
            width: 16px;
        }

        .month-name {
            font-size: 14px;
            font-weight: 500;
        }

        /* Main Content */
        .mainx-contentx {
            flex: 1;
            padding-top: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #fff;
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
        }

        .empty-icon {
            font-size: 80px;
            color: #dee2e6;
            margin-bottom: 20px;
        }

        .empty-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #495057;
        }

        .empty-description {
            font-size: 14px;
            line-height: 1.5;
        }

        /* PDF Viewer */
        .pdf-viewer {
            width: 100%;
            height: calc(100vh - 80px);
            display: none;
        }

        .pdf-viewer.active {
            display: block;
        }

        .pdf-frame {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Loading State */
        .loading-state {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #6c757d;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebarxx {
                width: 250px;
            }
            
            .search-input {
                width: 200px;
            }
            
            .header-title {
                display: none;
            }
        }

        @media (max-width: 600px) {
            .payslip-container {
                flex-direction: column;
            }
            
            .sidebarxx {
                width: 100%;
                height: 300px;
                padding-top: 60px;
            }
            
            .mainx-contentx {
                padding-top: 20px;
                min-height: calc(100vh - 300px);
            }
        }
    </style>
</head>
<body>
    <div class="payslip-container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Recherche">
                </div>
                <h1 class="header-title">Mes bulletins de paie</h1>
            </div>
            <button class="download-button" id="downloadBtn" disabled>
                <i class="fas fa-download"></i>
                Télécharger mes bulletins
            </button>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-section">
                <!-- 2023 -->
                <div class="year-section expanded" data-year="2023">
                    <div class="year-header">
                        <div class="year-title">
                            <i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>
                            2023
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="year-count">2</span>
                            <i class="fas fa-chevron-right chevron"></i>
                        </div>
                    </div>
                    <div class="months-list">
                        <div class="month-item" data-month="novembre" data-year="2023" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Novembre 2023</span>
                        </div>
                        <div class="month-item" data-month="octobre" data-year="2023" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Octobre 2023</span>
                        </div>
                    </div>
                </div>

                <!-- 2024 -->
                <div class="year-section" data-year="2024">
                    <div class="year-header">
                        <div class="year-title">
                            <i class="fas fa-calendar-alt" style="margin-right: 8px;"></i>
                            2024
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="year-count">12</span>
                            <i class="fas fa-chevron-right chevron"></i>
                        </div>
                    </div>
                    <div class="months-list">
                        <div class="month-item" data-month="décembre" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Décembre 2024</span>
                        </div>
                        <div class="month-item" data-month="novembre" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Novembre 2024</span>
                        </div>
                        <div class="month-item" data-month="octobre" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Octobre 2024</span>
                        </div>
                        <div class="month-item" data-month="septembre" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Septembre 2024</span>
                        </div>
                        <div class="month-item" data-month="août" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Août 2024</span>
                        </div>
                        <div class="month-item" data-month="juillet" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Juillet 2024</span>
                        </div>
                        <div class="month-item" data-month="juin" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Juin 2024</span>
                        </div>
                        <div class="month-item" data-month="mai" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Mai 2024</span>
                        </div>
                        <div class="month-item" data-month="avril" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Avril 2024</span>
                        </div>
                        <div class="month-item" data-month="mars" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Mars 2024</span>
                        </div>
                        <div class="month-item" data-month="février" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Février 2024</span>
                        </div>
                        <div class="month-item" data-month="janvier" data-year="2024" data-pdf="docs/Bulletin de paie TAMBUA.pdf">
                            <i class="fas fa-file-pdf month-icon"></i>
                            <span class="month-name">Janvier 2024</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">
                    <i class="fas fa-file-invoice"></i>
                </div>
                <h2 class="empty-title">Sélectionnez un bulletin de paie</h2>
                <p class="empty-description">
                    Choisissez un mois dans la liste de gauche<br>
                    pour afficher votre bulletin de paie
                </p>
            </div>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <p class="loading-text">Chargement du bulletin de paie...</p>
            </div>

            <!-- PDF Viewer -->
            <div class="pdf-viewer" id="pdfViewer">
                <iframe class="pdf-frame" id="pdfFrame" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        class PayslipManager {
            constructor() {
                this.currentPdf = null;
                this.currentMonth = null;
                this.currentYear = null;
                
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                // Gestion des années (expand/collapse)
                document.querySelectorAll('.year-header').forEach(header => {
                    header.addEventListener('click', (e) => {
                        const yearSection = header.parentElement;
                        this.toggleYearSection(yearSection);
                    });
                });

                // Gestion des clics sur les mois
                document.querySelectorAll('.month-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        this.selectMonth(item);
                    });
                });

                // Gestion du bouton de téléchargement
                document.getElementById('downloadBtn').addEventListener('click', () => {
                    this.downloadCurrentPdf();
                });

                // Gestion de la recherche
                document.querySelector('.search-input').addEventListener('input', (e) => {
                    this.filterMonths(e.target.value);
                });
            }

            /**
             * Expand/Collapse une section d'année
             * @param {HTMLElement} yearSection - L'élément de la section année
             */
            toggleYearSection(yearSection) {
                yearSection.classList.toggle('expanded');
                
                // Animation smooth pour l'ouverture/fermeture
                const monthsList = yearSection.querySelector('.months-list');
                if (yearSection.classList.contains('expanded')) {
                    monthsList.style.maxHeight = monthsList.scrollHeight + 'px';
                } else {
                    monthsList.style.maxHeight = '0px';
                }
            }

            /**
             * Sélectionne un mois et charge le PDF correspondant
             * @param {HTMLElement} monthItem - L'élément du mois sélectionné
             */
            selectMonth(monthItem) {
                // Retirer la classe active de tous les mois
                document.querySelectorAll('.month-item').forEach(item => {
                    item.classList.remove('active');
                });

                // Ajouter la classe active au mois sélectionné
                monthItem.classList.add('active');

                // Récupérer les informations du mois
                const month = monthItem.dataset.month;
                const year = monthItem.dataset.year;
                const pdfPath = monthItem.dataset.pdf;

                this.currentMonth = month;
                this.currentYear = year;
                this.currentPdf = pdfPath;

                // Charger le PDF
                this.loadPdf(pdfPath);

                // Activer le bouton de téléchargement
                this.enableDownloadButton();
            }

            /**
             * Charge un PDF dans la zone de prévisualisation
             * @param {string} pdfPath - Le chemin vers le fichier PDF
             */
            loadPdf(pdfPath) {
                const emptyState = document.getElementById('emptyState');
                const loadingState = document.getElementById('loadingState');
                const pdfViewer = document.getElementById('pdfViewer');
                const pdfFrame = document.getElementById('pdfFrame');

                // Masquer l'état vide
                emptyState.style.display = 'none';
                
                // Afficher l'état de chargement
                loadingState.style.display = 'flex';
                pdfViewer.classList.remove('active');

                // Simuler un délai de chargement pour une meilleure UX
                setTimeout(() => {
                    // Charger le PDF dans l'iframe
                    pdfFrame.src = pdfPath;
                    
                    // Masquer le chargement et afficher le PDF
                    loadingState.style.display = 'none';
                    pdfViewer.classList.add('active');
                }, 800);

                // Gérer les erreurs de chargement
                pdfFrame.onload = () => {
                    loadingState.style.display = 'none';
                    pdfViewer.classList.add('active');
                };

                pdfFrame.onerror = () => {
                    this.showError('Erreur lors du chargement du bulletin de paie');
                };
            }

            /**
             * Active le bouton de téléchargement
             */
            enableDownloadButton() {
                const downloadBtn = document.getElementById('downloadBtn');
                downloadBtn.disabled = false;
                downloadBtn.textContent = '';
                downloadBtn.innerHTML = '<i class="fas fa-download"></i> Télécharger mon bulletin';
            }

            /**
             * Télécharge le PDF actuellement sélectionné
             */
            downloadCurrentPdf() {
                if (!this.currentPdf) {
                    alert('Aucun bulletin de paie sélectionné');
                    return;
                }

                // Créer un lien de téléchargement temporaire
                const link = document.createElement('a');
                link.href = this.currentPdf;
                link.download = `Bulletin_${this.currentMonth}_${this.currentYear}.pdf`;
                
                // Déclencher le téléchargement
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // Feedback visuel
                this.showDownloadFeedback();
            }

            /**
             * Affiche un feedback visuel lors du téléchargement
             */
            showDownloadFeedback() {
                const downloadBtn = document.getElementById('downloadBtn');
                const originalContent = downloadBtn.innerHTML;
                
                downloadBtn.innerHTML = '<i class="fas fa-check"></i> Téléchargé !';
                downloadBtn.style.backgroundColor = '#28a745';
                
                setTimeout(() => {
                    downloadBtn.innerHTML = originalContent;
                    downloadBtn.style.backgroundColor = '#007bff';
                }, 2000);
            }

            /**
             * Filtre les mois selon la recherche
             * @param {string} searchTerm - Le terme de recherche
             */
            filterMonths(searchTerm) {
                const monthItems = document.querySelectorAll('.month-item');
                const searchLower = searchTerm.toLowerCase();

                monthItems.forEach(item => {
                    const monthName = item.querySelector('.month-name').textContent.toLowerCase();
                    
                    if (monthName.includes(searchLower)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });

                // Masquer les années qui n'ont aucun mois visible
                document.querySelectorAll('.year-section').forEach(yearSection => {
                    const visibleMonths = yearSection.querySelectorAll('.month-item[style*="flex"]').length;
                    const totalMonths = yearSection.querySelectorAll('.month-item').length;
                    
                    if (searchTerm && visibleMonths === 0) {
                        yearSection.style.display = 'none';
                    } else {
                        yearSection.style.display = 'block';
                    }
                });
            }

            /**
             * Affiche un message d'erreur
             * @param {string} message - Le message d'erreur
             */
            showError(message) {
                const emptyState = document.getElementById('emptyState');
                const loadingState = document.getElementById('loadingState');
                const pdfViewer = document.getElementById('pdfViewer');

                loadingState.style.display = 'none';
                pdfViewer.classList.remove('active');
                
                emptyState.style.display = 'flex';
                emptyState.innerHTML = `
                    <div class="empty-icon">
                        <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                    </div>
                    <h2 class="empty-title">Erreur</h2>
                    <p class="empty-description">${message}</p>
                `;
            }
        }

        // Initialiser l'application au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
            new PayslipManager();
        });
    </script>
</body>
</html>